# 值班管理系统测试用例

## 1. SQL语法错误修复测试
**测试用例编号**：TC001
**测试目标**：验证数据库表结构正确，不存在"Unknown column 'schedule_mode_id' in 'field list'"错误
**测试步骤**：
1. 执行`hyper_duty_ddl.sql`脚本创建数据库表
2. 执行`hyper_duty_dml.sql`脚本插入初始数据
3. 执行查询：`SELECT id,schedule_name,description,start_date,end_date,schedule_mode_id,status,create_by,create_time,update_time FROM duty_schedule`
**预期结果**：查询成功执行，返回值班表数据

## 2. 排班模式列表显示测试
**测试用例编号**：TC002
**测试目标**：验证DutyAssignment.vue组件中排班模式列表正确显示
**测试步骤**：
1. 启动前端应用
2. 登录系统
3. 进入值班安排页面
4. 点击批量排班按钮
5. 选择"排班模式"选项
**预期结果**：
- 排班模式下拉框显示可用的排班模式列表
- 每个排班模式显示名称和描述
- 暂无排班模式时显示警告提示

## 3. 排班模式API访问测试
**测试用例编号**：TC003
**测试目标**：验证排班模式API接口正常工作
**测试步骤**：
1. 启动后端服务
2. 发送GET请求到`/duty/schedule-mode/list`
**预期结果**：返回状态码200，包含启用的排班模式列表

## 4. 请假审批检查排班功能测试
**测试用例编号**：TC004
**测试目标**：验证请假审批页面的检查排班功能正常工作
**测试步骤**：
1. 启动前端应用
2. 登录系统
3. 进入请假审批页面
4. 选择一条待审批记录
5. 点击审批按钮
6. 选择"检查排班"选项
7. 点击确定
**预期结果**：
- 显示检查结果
- 正确提示是否有冲突的排班

## 5. 操作日志记录测试
**测试用例编号**：TC005
**测试目标**：验证操作日志自动记录功能正常工作
**测试步骤**：
1. 启动后端服务
2. 登录系统
3. 执行一系列操作（如查看值班表、创建值班安排等）
4. 查询operation_log表
**预期结果**：
- 每条操作都被记录到日志表中
- 包含操作人、操作类型、操作模块等信息
- JWT解析失败时使用默认值

## 6. 自动排班API测试
**测试用例编号**：TC006
**测试目标**：验证根据排班模式生成排班的API正常工作
**测试步骤**：
1. 启动后端服务
2. 发送POST请求到`/duty/auto-schedule/generate-by-mode`
3. 请求体包含必要参数：scheduleId, startDate, endDate, modeId, configParams
**预期结果**：返回状态码200，包含生成的排班安排列表

## 7. 批量排班功能测试
**测试用例编号**：TC007
**测试目标**：验证批量排班功能正常工作
**测试步骤**：
1. 启动前端应用
2. 登录系统
3. 进入值班安排页面
4. 选择值班表
5. 点击批量排班按钮
6. 选择日期范围和排班方式
7. 点击确定
**预期结果**：
- 成功生成排班安排
- 日历上显示新生成的排班
- 显示成功提示信息

## 8. 排班模式与算法关联测试
**测试用例编号**：TC008
**测试目标**：验证排班模式与排班算法正确关联
**测试步骤**：
1. 检查hyper_duty_dml.sql中排班模式的algorithm_class字段
2. 验证该字段指向正确的算法实现类
3. 执行自动排班操作
**预期结果**：
- 排班模式正确关联到对应的算法
- 算法正常执行生成排班

## 9. 请假审批流程测试
**测试用例编号**：TC009
**测试目标**：验证完整的请假审批流程
**测试步骤**：
1. 启动前端应用
2. 登录系统
3. 进入请假审批页面
4. 选择一条待审批记录
5. 填写审批意见
6. 选择审批结果
7. 点击确定
**预期结果**：
- 审批状态更新
- 显示成功提示
- 自动处理排班（如果选择）

## 10. JWT认证测试
**测试用例编号**：TC010
**测试目标**：验证JWT认证机制正常工作
**测试步骤**：
1. 启动后端服务
2. 发送请求到需要认证的API接口
3. 携带无效或过期的JWT令牌
4. 携带有效JWT令牌
**预期结果**：
- 无效令牌返回401状态码
- 有效令牌正常访问API
- 操作日志正确记录操作人信息

## 11. 加班时长填写测试
**测试用例编号**：TC011
**测试目标**：验证值班记录页面的加班时长填写功能正常工作
**测试步骤**：
1. 启动前端应用
2. 登录系统
3. 进入值班记录页面
4. 选择值班表和值班日期班次
5. 填写加班时长（如2.5小时）
6. 点击保存
**预期结果**：
- 加班时长成功保存
- 显示成功提示信息
- 值班记录列表中显示加班时长和审批状态为待审批

## 12. 加班时长审批测试
**测试用例编号**：TC012
**测试目标**：验证值班长对加班时长的审批功能正常工作
**测试步骤**：
1. 启动前端应用
2. 以值班长身份登录系统
3. 进入值班记录页面
4. 选择一条状态为待审批的加班记录
5. 点击审批按钮
6. 选择审批通过
7. 点击确定
**预期结果**：
- 审批状态更新为已审批
- 显示成功提示信息
- 值班记录列表中状态更新

## 13. 可调休工时统计测试
**测试用例编号**：TC013
**测试目标**：验证排班统计页面的可调休工时统计功能正常工作
**测试步骤**：
1. 启动前端应用
2. 登录系统
3. 进入排班统计页面
4. 选择员工排班统计选项
5. 查看可调休工时列
**预期结果**：
- 显示每个员工的可调休工时
- 可调休工时等于审批通过的加班时长总和
- 数据与后端计算结果一致

## 14. 加班时长计算测试
**测试用例编号**：TC014
**测试目标**：验证后端加班时长计算逻辑正确
**测试步骤**：
1. 启动后端服务
2. 发送GET请求到`/duty/statistics/employee`
3. 检查返回的compensatoryHours字段
**预期结果**：
- 返回状态码200
- compensatoryHours字段值等于审批状态为approved的加班时长总和
- 计算逻辑正确，只统计已审批的加班时长

## 15. 加班时长边界值测试
**测试用例编号**：TC015
**测试目标**：验证加班时长填写的边界值处理
**测试步骤**：
1. 启动前端应用
2. 登录系统
3. 进入值班记录页面
4. 尝试填写加班时长为0小时
5. 尝试填写加班时长为24小时
6. 尝试填写加班时长为负数
**预期结果**：
- 0小时和24小时可以正常保存
- 负数会被限制为最小值0
- 系统提供友好的输入验证提示

## 16. 审批流程完整性测试
**测试用例编号**：TC016
**测试目标**：验证加班时长审批流程的完整性
**测试步骤**：
1. 启动前端应用
2. 以普通用户身份登录，填写加班时长
3. 以值班长身份登录，审批加班申请
4. 再次以普通用户身份登录，查看审批结果
5. 进入排班统计页面，查看可调休工时
**预期结果**：
- 普通用户可以正常填写加班时长
- 值班长可以正常审批加班申请
- 审批结果实时更新
- 可调休工时正确统计审批通过的加班时长

## 17. 多用户加班统计测试
**测试用例编号**：TC017
**测试目标**：验证多用户加班时长的统计准确性
**测试步骤**：
1. 启动前端应用
2. 分别以多个用户身份登录，填写加班时长
3. 以值班长身份登录，审批所有加班申请
4. 进入排班统计页面，查看所有用户的可调休工时
**预期结果**：
- 每个用户的加班时长都能正确保存
- 值班长可以批量审批多个加班申请
- 排班统计页面显示每个用户的可调休工时
- 统计数据准确，与实际审批通过的加班时长一致

## 18. 加班时长编辑测试
**测试用例编号**：TC018
**测试目标**：验证加班时长的编辑功能
**测试步骤**：
1. 启动前端应用
2. 登录系统
3. 进入值班记录页面
4. 选择一条已保存但未审批的加班记录
5. 修改加班时长
6. 点击保存
**预期结果**：
- 加班时长成功更新
- 显示成功提示信息
- 值班记录列表中显示更新后的加班时长
- 审批状态保持为待审批

## 19. 审批拒绝测试
**测试用例编号**：TC019
**测试目标**：验证值班长拒绝加班申请的功能
**测试步骤**：
1. 启动前端应用
2. 以值班长身份登录系统
3. 进入值班记录页面
4. 选择一条状态为待审批的加班记录
5. 点击审批按钮
6. 选择审批拒绝
7. 点击确定
**预期结果**：
- 审批状态更新为已拒绝
- 显示成功提示信息
- 值班记录列表中状态更新
- 被拒绝的加班时长不纳入可调休工时统计

## 20. 数据持久化测试
**测试用例编号**：TC020
**测试目标**：验证加班时长和审批状态的数据持久化
**测试步骤**：
1. 启动前端应用和后端服务
2. 登录系统，填写加班时长并保存
3. 重启后端服务
4. 重新登录系统，查看值班记录
5. 进入排班统计页面，查看可调休工时
**预期结果**：
- 加班时长和审批状态正确保存在数据库中
- 服务重启后数据不丢失
- 可调休工时统计数据保持一致
